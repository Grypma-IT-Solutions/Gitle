function GitleIssues(){}$(function(){var n=undefined;$(".booking-edit").on("click",function(t){t.preventDefault();var u=$(this).parents(".booking-row");n!=undefined&&(n.find(".booking-row-edit").remove(),n.find(".booking-row-content").show());n=u;$.ajax({method:"GET",data:{id:u.data("id")},url:"/booking/edit",success:function(n){u.find(".booking-row-content").hide();u.prepend(n);r(u);i(u)}})});var r=function(t){t.find(".booking-edit-cancel").on("click",function(i){i.preventDefault();t.find(".booking-row-edit").remove();t.find(".booking-row-content").show();n=undefined})},t={format:"dd-mm-yyyy",weekStart:1},i=function(n){n.find(".project-chooser").data("suggestion",undefined);n.find(".project-chooser").autocomplete({serviceUrl:"/project/autocomplete",autoSelectFirst:!0,noCache:!0,minChars:0,onSelect:function(t){var i=n.find(".project-chooser");if(i.data("suggestion")!=undefined&&i.data("suggestion")==t.data)return!1;i.data("suggestion",t.data).val(t.value);n.find(".booking_Project_Id").val(t.data);n.find(".issue-chooser").val("").autocomplete("setOptions",{params:{projectId:t.data}});n.find(".booking_Issue_Id").val("")}}).on("focus",function(){$(this).autocomplete().onValueChange()});n.find(".issue-chooser").autocomplete({serviceUrl:"/issue/autocomplete",params:{projectId:n.find(".booking_Project_Id").val()},autoSelectFirst:!0,noCache:!0,minChars:0,width:n.find(".project-chooser").width(),onSelect:function(t){n.find(".booking_Issue_Id").val(t.data);n.find(".issue-chooser").val(t.value)}});var i=n.find(".booking_Minutes");$(".booking-parser").change(function(){var n=$(this).val().replace(",","."),e=n,f=n,r,o,u,t;if(/^[0-9]+$/i.test(n)&&(r=parseInt(n),r>9?(u=parseInt(r/60),t=r-u*60,e=u+":"+(t<10?"0"+t:t),f=r):(e=r+":00",f=r*60)),/^([0-9]+):([0-9]{2})$/i.test(n)){var s=n.split(":"),o=parseFloat(s[0]),h=parseFloat(s[1]);f=o*60+h}/^([0-9]+)\.([0-9]+)$/i.test(n)&&(o=parseFloat(n),f=o*60,u=parseInt(n),t=(o-u)*60,e=u+":"+(t<10?"0"+t:t));$(this).val(e);i.val(f)});n.find(".date").fdatepicker(t)};i($(".booking-row-new"));$(".date").fdatepicker(t).on("show",function(){$("[data-dayshift]").removeClass("active")});$("[data-dayshift]").each(function(){var t=$(this).data("dayshift"),n="";switch(t){case 0:n="Vandaag";break;case-1:n="Gisteren";break;default:n=Date.today().add(t).days().toString("ddd dd MMM")}$(this).text(n)}).click(function(n){n.preventDefault();var t=Date.today(),i=$(this).data("dayshift"),r=t.add(i).days();$("#booking_Date").val(r.toString("dd-MM-yyyy"));$("[data-dayshift]").removeClass("active");$(this).addClass("active")}).filter("[data-dayshift=0]").click()});$(function(){var i=function(n){var r=$(".invoiceline[data-issue="+n+"]"),t=r.find(".invoiceline-hours"),u=parseFloat(t.text()),i=r.find(".invoiceline-estimate"),f=parseFloat(i.text());u<f?(i.addClass("success"),t.addClass("alert")):(i.addClass("alert"),t.addClass("success"))},t=function(t){var i=parseFloat($("#invoice_HourPrice").val()),r=parseFloat(t.find(".invoiceline-hours-input").val().replace(",",".")),u=parseInt(t.find(".invoiceline-null").val()),f=r*i*(1-u);t.find(".invoiceline-price").val(f.toString().replace(".",","));n()},n=function(){var n=0,t,r,i,u;$(".invoiceline").each(function(){var t=parseFloat($(this).find(".invoiceline-price").val().replace(",","."))*(1-parseInt($(this).find(".invoiceline-null").val()));n+=t});$("#invoice_Subtotal").val(n.toString().replace(".",","));t=0;$(".correctionline").each(function(){var n=$(this).find(".correctionline-price").val();n&&(t+=parseFloat(n.replace(",",".")))});r=parseInt($(".vatline .vatline-vat").val());i=(n+t)*r*.21;$(".vatline-price").val(i.toString().replace(".",","));u=n+t+i;$("#invoice_Total").val(u.toString().replace(".",","))};$(".invoiceline-issue").each(function(){i($(this).data("issue"))});$("#invoice_HourPrice").keyup(function(){$(".invoiceline").each(function(){t($(this))})}).keyup();n();$(".invoiceline-hours-input").on("change keyup",function(){var n=$(this).parents(".invoiceline");t(n);n.find(".invoiceline-estimate, .invoiceline-hours").removeClass("active");var i=parseFloat($(this).val().replace(",",".")),r=parseFloat(n.find(".invoiceline-estimate").text().replace(",",".")),u=parseFloat(n.find(".invoiceline-hours").text().replace(",","."));i==r?n.find(".invoiceline-estimate").addClass("active"):i==u&&n.find(".invoiceline-hours").addClass("active")});$(".correctionline-price").keyup(function(){n()});$(".invoiceline-estimate, .invoiceline-hours").click(function(n){n.preventDefault();var i=$(this).text(),t=$(this).parents(".invoiceline");t.find(".invoiceline-hours-input").val(i).change();t.find(".invoiceline-estimate, .invoiceline-hours").removeClass("active");$(this).addClass("active")});$(".remove-line").click(function(t){t.preventDefault();var i=$(this).parents(".invoiceline");i.data("issue")&&$(".booking[data-issue="+i.data("issue")+"]").remove();i.remove();n()});$(".invoiceline-null-toggle").click(function(i){i.preventDefault();var r=$(this).parents(".invoiceline");$(this).hasClass("null")?($(this).removeClass("null"),r.find(".invoiceline-null").val(0),r.find(".invoiceline-price").removeClass("null")):($(this).addClass("null"),r.find(".invoiceline-null").val(1),r.find(".invoiceline-price").addClass("null"));t(r);n()});$(".vatline-toggle").click(function(t){t.preventDefault();var i=$(this).parents(".vatline");$(this).hasClass("vat")?($(this).removeClass("vat"),i.find(".vatline-vat").val(1),i.find(".vatline-price").removeClass("null")):($(this).addClass("vat"),i.find(".vatline-vat").val(0),i.find(".vatline-price").addClass("null"));n()})});GitleIssues.prototype={init:function(){this.initThreeStateChecker();this.initGroupActions();this.initQuickView();this.initTimeParser()},initThreeStateChecker:function(){$(".three-state-checker").each(function(){var t=$(this),i,n;t.append('<i class="fa fa-square-o none"><\/i><i class="fa fa-check-square-o all"><\/i><i class="fa fa-minus-square-o some"><\/i>');i=$(this).data("selector");n=$(i);n.click(function(){n.length==n.filter(":checked").length?t.attr("data-state","all"):n.filter(":checked").length===0?t.attr("data-state","none"):t.attr("data-state","some")})}).click(function(){var t=$(this).data("selector"),i=$(this).attr("data-state"),n=$(t);switch(i){case"none":n.attr("checked","checked");$(this).attr("data-state","all");break;default:n.removeAttr("checked");$(this).attr("data-state","none")}n.change()})},initGroupActions:function(){$("#group-actions").hide();$(".issues input[type=checkbox][name=issue]").change(function(){var t=$(".issues input[type=checkbox][name=issue]:checked"),n;t.length>0?$("#group-actions, #exportselection").show():$("#group-actions, #exportselection").hide();n=[];t.each(function(){n.push($(this).val())});$("#group-actions [name=issues]").val(n.join(","))}).change();$("[data-group-action]").click(function(n){n.preventDefault();var i=$("#group-actions input[name=issues]").val(),t=$(this).prop("href");location.href=t+(t.indexOf("?")==-1?"?":"&")+"issues="+i});$(".issue").click(function(){var n=$(this).find("input[type=checkbox]");n.prop("checked",!n.is(":checked")).change()}).on("click","a, input",function(n){n.stopPropagation()})},initQuickView:function(){var n=800;$("[data-quickview]").hover(function(){var t=$(this),r,i;$(this).data("tooltip")==undefined?(r=$(this).position(),i=$('<div class="quickview">').css("top",r.top+$(this).height()).css("left",r.left),$(this).data("tooltip",i),i.load($(this).data("quickview"),function(){i.find(".marked").each(function(){$(this).html(marked($(this).html()))});t.append(i.hide());t.data("timeout",setTimeout(function(){t.is(":hover")&&t.data("tooltip").show()},n))})):t.data("timeout",setTimeout(function(){t.is(":hover")&&t.data("tooltip").show()},n))},function(){$(".quickview").hide()})},initTimeParser:function(){$(".time-parser").blur(function(){var n=$(this).val(),t;n!==""&&n!=="0"&&(n=n.replace(/[A-Za-z$-]/g,""),n=n.replace(",","."),n=parseFloat(n),t=n<.25,t&&(n=.25),n=n.toString().replace(".",","),$(this).val(n),t&&$(this).error("minimum is een kwartier"))})}};var gitleIssues=null;$(function(){gitleIssues=new GitleIssues;gitleIssues.init()});